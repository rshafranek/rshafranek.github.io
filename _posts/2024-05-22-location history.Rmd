---
title: "Where I've Been"
author: "Richard M. Shafranek"
date: "2024-05-22"
layout: post
always_allow_html: true
output:
  md_document:
    variant: markdown_github
    preserve_yaml: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(base.dir = "rshafranek.github.io/", base.url = "/")
knitr::opts_chunk$set(fig.path = "images/")
# libraries
library(ggmap)
library(jsonlite)
library(tidyverse)
library(sf)
library(tigris)
library(ggrepel)

library("rnaturalearth")
library("rnaturalearthdata")

library(maps)
library(mapdata)

library(plotly)

# load the data
places_read <- read.csv("C:/Users/richa/OneDrive/Documents/tracking/location history/places.csv")
places_read$year <- as.factor(places_read$year)
places_sf <- st_as_sf(places_read, wkt = "geometry_wkt", crs = st_crs("EPSG:4326"))

# set up the map
world <- ne_countries(scale = "medium", returnclass = "sf")
world_points<- st_centroid(world)
world_points <- cbind(world, st_coordinates(st_centroid(world$geometry))) %>% filter(continent=="Europe"|continent=="North America") %>% filter((name_en %in% c("United States of America", "Ireland", "Iceland", "Canada", "Germany", "Belgium", "Netherlands", "Czech Republic", "Hungary")))

us_states <- states(resolution = "20m", year = 2022, cb = TRUE)

trip_window <- st_sfc(
  st_point(c(-125.000, 27.5)),  # left (west), bottom (south)
  st_point(c(20.000, 65.000)),   # right (east), top (north)
  crs = st_crs("EPSG:4326")  # WGS 84
) %>% 
  st_coordinates()

# create the plot
maptry3 <- ggplot() + geom_sf(data = world) + geom_sf(data = us_states, fill=NA) + theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.25), panel.background = element_rect(fill = "aliceblue")) + geom_sf(data = places_sf, aes(fill=year, size=as.numeric(duration),  text = paste(
  "Year: ", year, "<br>",
  "Duration (minutes): ", round(as.numeric(duration), digits=0), "<br>"
)), shape=21, stroke=.25, color="black"
) + scale_fill_brewer(palette = "PiYG") + # geom_sf(data=places_sf, aes(color="black", shape=21, stroke=0.5, fill=NA, size=as.numeric(places_sf$duration))) + 
  coord_sf(
  xlim = trip_window[, "X"],
  ylim = trip_window[, "Y"]) + ggtitle("Places I've been, June 2016 - May 2024") + geom_text_repel(data= world_points,aes(x=X, y=Y, label=name), color = "darkblue", fontface = "bold", check_overlap = TRUE, nudge_y=1.5) + guides(size="none") + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

maptry_plotly <- ggplotly(maptry3, tooltip=c("text"))
```

## Location history data
I've been using Google Location History ever since switching to an Android device in mid-2016. Many people, understandably concerned about their privacy or just plain creeped out by the concept, turn location history off, but I appreciate the way it effortlessly creates a record of my days. It's like an auto-generated daily diary that eliminates the hassle of having to write down your deeds by hand. 

It's pretty easy to view your history at [https://timeline.google.com/](https://timeline.google.com/), but I wanted to export my data, analyze it, and create some custom views. 

## Static plot

You can also embed plots, for example:

```{r ggplot, echo=FALSE, fig.width = 10, fig.height = 6, out.width = "100%", fig.retina=3}
maptry3
```

## Interactive (plotly) plot

```{r plotly, echo=FALSE, fig.width = 10, fig.height = 6, out.width = "100%"}
maptry_plotly
```